---
import { Image } from "astro:assets";
import moon from "../assets/moon.svg";
import sun from "../assets/sun.svg";
import Button from "./Button.astro";
---

<Button id="themeToggle" title="Click to switch Theme">
  <Image src={moon} alt="Moon Icon" class="moon" />
  <Image src={sun} alt="Sun Icon" class="sun" />
</Button>

<style>
  #themeToggle {
    padding: 0.25rem 0.3rem;
    border-color: gray;
  }
  .sun {
    display: block;
  }
  .moon {
    display: none;
  }

  :global(.dark) .sun {
    display: none;
  }
  :global(.dark) .moon {
    display: block;
  }
  @media (orientation: portrait) {
    #themeToggle {
      padding: 0.25rem 0.3rem;
      margin-left: auto;
    }
  }
</style>

<script is:inline>
  if (window.theme) {
    window.theme =
      localStorage?.getItem("theme") ??
      (window.matchMedia("(prefers-color-scheme: dark)").matches
        ? "dark"
        : "light");
  }

  if (window.theme === "light") {
    document.documentElement.classList.add("light");
    document.documentElement.classList.remove("dark");
  } else {
    document.documentElement.classList.add("dark");
    document.documentElement.classList.remove("light");
  }

  localStorage.setItem("theme", window.theme);

  handleToggleClick = () => {
    const element = document.documentElement;
    element.classList.toggle("light");
    element.classList.toggle("dark");

    const isDark = element.classList.contains("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  };

  document
    .getElementById("themeToggle")
    .addEventListener("click", handleToggleClick);
</script>
